FROM ollama/ollama:latest

# Install curl using apt-get (Debian/Ubuntu)
RUN apt-get update && apt-get install -y curl && rm -rf /var/lib/apt/lists/*

# Create a startup script
RUN printf '#!/bin/sh\nset -e\n\n# Start Ollama in the background\n/usr/local/bin/ollama serve &\n\n# Wait for server to start\nuntil curl -s http://localhost:11434/api/tags >/dev/null; do\n  echo "Waiting for Ollama to start..."\n  sleep 1\ndone\n\n# Pull the model\necho "Pulling Mistral model..."\n/usr/local/bin/ollama pull mistral\n\n# Keep container running\ntail -f /dev/null\n' > /start.sh && chmod +x /start.sh

# Set the entrypoint
ENTRYPOINT ["/bin/sh", "/start.sh"]
